@page "/DMBoard/FileDirectory"

@using System.IO
@using BagOfManyThings.Components.Account
@using BagOfManyThings.Data
@using Microsoft.AspNetCore.Identity

@inject FileService FileService
@inject UserManager<ApplicationUser> UserManager
@inject IdentityUserAccessor UserAccessor


<PageTitle>File System - Directory</PageTitle>

<h3>Campaign Content</h3>

<AuthorizeView>
    <NotAuthorized>
        <h1 class="text-danger">Access denied</h1>
        <p class="text-danger">Please log into your account.</p>
    </NotAuthorized>
    <Authorized>

        <FileTree basePath="@basePath"/>

    </Authorized>
    <Authorizing>
        <p>Loading your board...</p>
    </Authorizing>
</AuthorizeView>

@code {

    private ApplicationUser user = default!;
    private string? userId;
    private string? basePath;

    [CascadingParameter]
    private HttpContext HttpContext { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        user = await UserAccessor.GetRequiredUserAsync(HttpContext);
        userId = await UserManager.GetUserIdAsync(user);
        basePath = FileService.GetUserDirectoryPath(userId);
    }


}